{% extends 'layouts/base.njk' %}

{% block content %}

 <section class="intro-banner" {% if bgText %} style="color:{{ bgText }}"{% endif %}>
            <div class="section-banner-wrapper">
                <div class="section-banner-title">
                    <h1>{{ pages.searchPage.searchHeader }}</h1>
                </div>
                <div class="section-banner-body banner-sub-title">
                    <p>{{ pages.searchPage.searchHeader | safe }}</p>
                    {{ content | safe }}
                
                <input type="search" placeholder="Search..." id="searchField" class="search" required />

                </div>
</section>    
<section class="intro-banner resources-bgs">
    <div class="content-container">
            <div class="search-section">
                <label for="searchField"></label>
                    <ol id="searchResults" />
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js"></script>
            </div>
                        <div class="section-banner-title">
                <p class="four">{{ wdefaults.commonWords.tagSubtitle | safe }}</p>
            </div>
            <div class="section-banner-body banner-sub-title">
                <ul>
                {% for tag in collections.tagList %}
                    {% set tagUrl %}/tags/{{ tag }}/{% endset %}
                    <li><a href="{{ tagUrl | url }}" class="tag">{{ tag }}</a> ({{ collections[tag].length }})</li>
                {% endfor %}
                </ul>
            </div>
      </div>
    </section>
{% endblock %}

<script>

(function(window, document) {
    "use strict";
  
    const search = e => {
      const results = window.searchIndex.search(e.target.value);
  
      const resEl = document.getElementById("searchResults");
      resEl.innerHTML = "";
      if (results && results.length > 0) {
        results.map(r => {
          const { id, title } = r.doc;
  
          // this is where you'll go wild with your own HTML injection.
          const el = document.createElement("li");
          resEl.appendChild(el);
  
          const h6 = document.createElement("h6");
          el.appendChild(h6);
  
          const a = document.createElement("a");
          a.setAttribute("href", id);
          a.textContent = title;
          h6.appendChild(a);
  


        });
      }
    };
  
    fetch("/search-index.json").then(response =>
      response.json().then(rawIndex => {
        window.searchIndex = elasticlunr.Index.load(rawIndex);
        document.getElementById("searchField").addEventListener("input", search);
      })
    );
  })(window, document);
  
</script>